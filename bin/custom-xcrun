#!/bin/bash

# This binary file decorates native xcrun binary and executes applescript to hide software keyboard in safari browser.

# We need to execute "Cmd + K" keystroke to toggle software keyboard. We need to do this only once on first
# simulator load. So we are creating temporary file and writing there ids of simulators where the keyboard has already been toggled.
# We don't need to make toggle if the file contains the simulator id. The file is temporary because we need to toggle
# keyboard again when device with simulator was rebooted (the file becomes empty after rebooting).

# touch /tmp/toggled-simulator-ids

# Calling xcrun with "spawn" and "launchctl" - moment when appium spawns a new session.
# if [[ $2 = "spawn" ]] && [[ $4 = "launchctl" ]]; then
    # grep -q $3 /tmp/toggled-simulator-ids;
    # if [ $? -ne 0 ]; then
        # echo -e $3 >> /tmp/toggled-simulator-ids
osascript <<EOD
tell application "Simulator"
    activate
    delay 0.5
    tell application "System Events" to keystroke "k" using {command down}
end tell
EOD
#     fi
# fi

# xcrun $@
